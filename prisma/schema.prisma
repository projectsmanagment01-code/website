generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Recipe {
  id                  String    @id @default(cuid())
  title               String
  category            String    // DEPRECATED: Keep temporarily for backward compatibility
  categoryId          String?   // NEW: Foreign key to Category model
  description         String
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  allergyInfo         String
  author              Json
  categoryHref        String?   // DEPRECATED: Will be removed after migration
  categoryLink        String    // DEPRECATED: Will be removed after migration
  completeProcess     Json?
  essIngredientGuide  Json?
  faq                 Json?
  featuredText        String
  heroImage           String
  href                String?
  imageAlt            String?
  images              String[]
  img                 String
  featureImage        String?
  cookingImage        String?
  preparationImage    String?
  finalPresentationImage String?
  ingredientGuide     Json?
  intro               String
  mustKnowTips        String[]
  notes               String[]
  nutritionDisclaimer String
  professionalSecrets String[]
  questions           Json?
  recipeInfo          Json?
  relatedRecipes      Json?
  sections            Json?
  serving             String
  shortDescription    String
  slug                String    @unique
  storage             String
  story               String
  testimonial         String
  timing              Json?
  tools               String[]
  updatedDate         String
  whyYouLove          Json?
  ingredients         Json?
  instructions        Json?
  lastViewedAt        DateTime?
  views               Int       @default(0)
  authorId            String?
  status              String    @default("published")
  
  // Relations
  authorRef           Author?   @relation("AuthorRecipes", fields: [authorId], references: [id])
  categoryRef         Category? @relation("CategoryRecipes", fields: [categoryId], references: [id], onDelete: SetNull)
  
  @@index([categoryId])
  @@index([status])
  @@index([createdAt])
}

model Author {
  id         String              @id @default(cuid())
  name       String
  bio        String?
  img        String?
  avatar     String?
  slug       String              @unique
  link       String?
  tags       String[]            @default([]) // Simple category tags (no relation to Category model)
  createdAt  DateTime            @default(now())
  updatedAt  DateTime            @updatedAt
  recipes    Recipe[]            @relation("AuthorRecipes")

  @@map("authors")
}

model Category {
  id          String   @id @default(cuid())
  name        String   // Display name (e.g., "Evening Meals", "Desserts")
  slug        String   @unique // URL-friendly (e.g., "evening-meals", "desserts")
  description String?  @db.Text // Full description for category page
  image       String   // Dedicated category image (stored in uploads/categories/)
  icon        String?  // Optional icon identifier for UI
  color       String?  // Brand color for category (hex code)
  order       Int      @default(0) // Display order (lower = shown first)
  isActive    Boolean  @default(true) // Active/inactive toggle
  
  // SEO fields
  metaTitle       String?  @db.Text
  metaDescription String?  @db.Text
  
  // Relations
  recipes     Recipe[] @relation("CategoryRecipes")
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([slug])
  @@index([isActive])
  @@index([order])
  @@map("categories")
}

model NavigationItem {
  id            String  @id @default(cuid())
  href          String
  title         String
  iconSrc       String
  iconClassName String
  label         String?
}

model AdminSettings {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String?
  updatedAt DateTime @updatedAt
  updatedBy String?
}

model ApiToken {
  id          String    @id @default(cuid())
  name        String
  token       String    @unique
  createdAt   DateTime  @default(now())
  expiresAt   DateTime
  isActive    Boolean   @default(true)
  lastUsedAt  DateTime?
  createdBy   String
  description String?

  @@map("api_tokens")
}

model SEOEnhancementReport {
  id                  String   @id @default(cuid())
  recipeId            String
  recipeTitle         String
  status              String   @default("pending") // pending, processing, success, failed
  seoScore            Int?
  enhancementsCount   Int      @default(0)
  processingTime      Int?     // in seconds
  metadataGenerated   Boolean  @default(false)
  imagesProcessed     Int      @default(0)
  linksGenerated      Int      @default(0)
  schemaEnhanced      Boolean  @default(false)
  errorMessage        String?
  aiResponse          Json?    // Store full AI response
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@map("seo_enhancement_reports")
  @@index([recipeId])
  @@index([status])
  @@index([createdAt])
}
